<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Udemy React TheCompleteGuide ch12 Look Behind The Scene of React | Jeremy's Blog</title><meta name="author" content="Jeremy"><meta name="copyright" content="Jeremy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="How React Really worksReact:JavaScript libraries for building interfaces  React  props state  context api  以上三種跟component的互動,並且把更動讓ReactDOM知道 ReactDOM  Interface to the web  What the users see  React">
<meta property="og:type" content="article">
<meta property="og:title" content="Udemy React TheCompleteGuide ch12 Look Behind The Scene of React">
<meta property="og:url" content="https://razieldu.github.io/2022/06/16/Udemy-React-TheCompleteGuide-ch12-A-Look-Behind-The-Scene-Of-React/index.html">
<meta property="og:site_name" content="Jeremy&#39;s Blog">
<meta property="og:description" content="How React Really worksReact:JavaScript libraries for building interfaces  React  props state  context api  以上三種跟component的互動,並且把更動讓ReactDOM知道 ReactDOM  Interface to the web  What the users see  React">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg">
<meta property="article:published_time" content="2022-06-16T13:13:55.000Z">
<meta property="article:modified_time" content="2022-06-18T06:08:19.131Z">
<meta property="article:author" content="Jeremy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://razieldu.github.io/2022/06/16/Udemy-React-TheCompleteGuide-ch12-A-Look-Behind-The-Scene-Of-React/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Udemy React TheCompleteGuide ch12 Look Behind The Scene of React',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-18 14:08:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">74</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jeremy's Blog</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Udemy React TheCompleteGuide ch12 Look Behind The Scene of React</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-06-16T13:13:55.000Z" title="Created 2022-06-16 21:13:55">2022-06-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-18T06:08:19.131Z" title="Updated 2022-06-18 14:08:19">2022-06-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/React/">React</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Udemy React TheCompleteGuide ch12 Look Behind The Scene of React"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="How-React-Really-works"><a href="#How-React-Really-works" class="headerlink" title="How React Really works"></a>How React Really works</h3><p>React:JavaScript libraries for building interfaces </p>
<p><strong>React</strong></p>
<ol>
<li>props</li>
<li>state </li>
<li>context api</li>
</ol>
<p>以上三種跟component的互動,並且把更動讓ReactDOM知道</p>
<p><strong>ReactDOM</strong></p>
<ol>
<li>Interface to the web </li>
<li>What the users see</li>
</ol>
<p><strong>React</strong> determines how our components look like and what they should look like</p>
<p><strong>ReactDOM</strong> receives the differences(required changes) and manipulate the real DOM(Document Object Model)  </p>
<h3 id="Re-evaluating-Components-x3D-x3D-Re-render-the-DOM"><a href="#Re-evaluating-Components-x3D-x3D-Re-render-the-DOM" class="headerlink" title="Re-evaluating Components !&#x3D;&#x3D; Re-render the DOM"></a>Re-evaluating Components !&#x3D;&#x3D; Re-render the DOM</h3><p><strong>React</strong> execute component functions,re-evaluate whenever props,state,or context changes </p>
<p><strong>RealDOM</strong> changes only made for <strong>differences between evaluations</strong></p>
<h3 id="Component-Updates-in-Action"><a href="#Component-Updates-in-Action" class="headerlink" title="Component Updates in Action"></a>Component Updates in Action</h3><p><strong>app.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import React,&#123;useState&#125; from &#x27;react&#x27;;</span><br><span class="line">import Button from &quot;./components/UI/Button/Button&quot;</span><br><span class="line">import &#x27;./App.css&#x27;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line"></span><br><span class="line">const[showParagraph,setShowParagraph]=useState(false)</span><br><span class="line"> </span><br><span class="line">console.log(&quot;Page Running!!&quot;)  </span><br><span class="line"></span><br><span class="line">////設置console.log來確認component的re-evaluate,打開開發人員介面,可以確認到state改變之後,console.log就被執行一次,但實際上的HTML結構只有&lt;p&gt;這個元素在變動</span><br><span class="line"></span><br><span class="line">const toggleParagraphHandler =()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">setShowParagraph(prevShowparagraph=&gt;!prevShowparagraph)</span><br><span class="line">////這個寫法可以造成toggle效果</span><br><span class="line">&#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Hi there!&lt;/h1&gt;</span><br><span class="line">      &#123;showParagraph &amp;&amp;&lt;p&gt;This is a new !!!&lt;/p&gt;&#125;</span><br><span class="line">      &lt;Button onClick=&#123;toggleParagraphHandler&#125;&gt;Toggle Paragraph!!&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<h3 id="A-closer-look-at-child-component"><a href="#A-closer-look-at-child-component" class="headerlink" title="A closer look at child component"></a>A closer look at child component</h3><p><strong>app.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import React,&#123;useState&#125; from &#x27;react&#x27;;</span><br><span class="line">import Button from &quot;./components/UI/Button/Button&quot;</span><br><span class="line">import DemoOutput from &#x27;./components/Demo/DemoOutput&#x27;;</span><br><span class="line">import &#x27;./App.css&#x27;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line"></span><br><span class="line">const[showParagraph,setShowParagraph]=useState(false)</span><br><span class="line"></span><br><span class="line">console.log(&quot;Page Running!!&quot;)</span><br><span class="line"></span><br><span class="line">const toggleParagraphHandler =()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">setShowParagraph(prevShowparagraph=&gt;!prevShowparagraph)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Hi there!&lt;/h1&gt;</span><br><span class="line">      &lt;DemoOutput show=&#123;showParagraph&#125;/&gt; ///DemoOutput設置點</span><br><span class="line">      &lt;Button onClick=&#123;toggleParagraphHandler&#125;&gt;Toggle Paragraph!!&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<p><strong>DemoOutput.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;</span><br><span class="line"></span><br><span class="line">const DemoOutput = (props)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">console.log(&quot;app Running!!&quot;)////在這邊也設置console.log</span><br><span class="line"></span><br><span class="line">return&lt;p&gt;&#123;props.show ? &quot;This is a new !!!&quot; : &quot;&quot;&#125;&lt;/p&gt; ///p的部分移動到另外一個 child component</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default DemoOutput</span><br></pre></td></tr></table></figure>

<p>可以確認到在realDOM的部分,我們看到DemoOutput設置點的位置一直會有一個 沒有內容的P tag,差別在於state變動的時候,P tag會變成有內容,所以在realDOM的部分是DemoOutput這個component在變動,但是因為state是設置在app.js,變動點設置在DemoOutput.js,所以當state變動的時候,兩個console.log都發動了</p>
<p><strong>更改設定</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;DemoOutput show=&#123;false&#125;/&gt; ///直接改為false</span><br></pre></td></tr></table></figure>

<p>p不再有toggle的效果,因為被直接設定為false</p>
<p><strong>父層state依然在變動並重新執行component子層也跟著重新執行,因為父層就像外層function執行之後,內層也跟著被call,即便在prop的資料傳遞上已經沒有關聯,realDOM的部分(HTML結構)都沒有變動</strong></p>
<p><strong>父層變動所有相關的子層都會變動</strong></p>
<h3 id="Preventing-Unnecessary-Re-Evaluations-with-React-memo"><a href="#Preventing-Unnecessary-Re-Evaluations-with-React-memo" class="headerlink" title="Preventing Unnecessary Re-Evaluations with React.memo()"></a>Preventing Unnecessary Re-Evaluations with React.memo()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;</span><br><span class="line"></span><br><span class="line">const DemoOutput = (props)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">console.log(&quot;Demo Running!!&quot;)</span><br><span class="line"></span><br><span class="line">return&lt;Paragraph&gt;&#123;props.show ? &quot;This is a new !!!&quot; : &quot;&quot;&#125;&lt;/Paragragh&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">export default React.memo(DemoOutput) ///加入React.memo</span><br></pre></td></tr></table></figure>

<p><strong>此時我們可以確認到,開發人員介面只有出現app.js的console.log結果,DemoOutput的子層Paragraph也沒有重新執行</strong></p>
<p>React should look at the props this component gets,and check the new value for all those props and compare to the previous value those props got,and <strong>only the value of a prop changes</strong>,the components should be re-evaluated and re-executed.</p>
<p>父層改變,但是子層的props of value 沒有改變,component execution will be skipped.</p>
<p><strong>為什麼不直接在所有的component使用呢?</strong></p>
<p>React在使用memo的時候做了兩件事情</p>
<ol>
<li>儲存先前的props value </li>
<li>跟目前的props value 做出比較</li>
</ol>
<p>在component tree 比較巨大的時候,我們可以在高層級的component使用</p>
<p><strong>我們在Button.js也使用React.memo但是Button.js的console.log發動了,為什麼?</strong></p>
<p>App.js是一個function,re-execute就像重新執行一個function,跟Button.js有關聯的是toggleParagraphHandler這個function,對於javascript來說,每一次execute,他都會變成一個新的function,同樣的每次重新執行  show&#x3D;{false} 這個false都會是新的false,但是為什麼同樣都使用了React.memo(),Button.js重新執行了,但是DemoOutput卻沒有被重新執行</p>
<p>&#x3D;&gt; false是布林值,就跟string以及number一樣都是primitive value(Number, String, Boolean, Undefined, Symbol, and BigInt)</p>
<p>Reference Value:array,object,function</p>
<p>在primitive value的層面:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">props.prevshow === props.show 這是可以成立的</span><br><span class="line">false===false ///true</span><br><span class="line"></span><br><span class="line">[1,2,3]===[1,2,3] ///false</span><br><span class="line"></span><br><span class="line">props.onClick===props. previous.onClick ////false,所以Button.js才會被執行因為toggleParagraphHandler在re-evaluate之後會被視為是一個新的function</span><br></pre></td></tr></table></figure>

<h3 id="Preventing-Function-Re-Creation-with-useCallback"><a href="#Preventing-Function-Re-Creation-with-useCallback" class="headerlink" title="Preventing Function Re-Creation with useCallback()"></a>Preventing Function Re-Creation with useCallback()</h3><p>告訴React把一個function儲存起來,這個function不會被re-execute,儲存在同一個位置,在re-execute時候取出</p>
<p>let obj1&#x3D;{}<br>let obj2&#x3D;{}<br>obj1&#x3D;&#x3D;&#x3D;obj2 &#x2F;&#x2F;&#x2F;false<br>obj2&#x3D;obj1<br>obj1&#x3D;&#x3D;&#x3D;obj2 &#x2F;&#x2F;&#x2F;true</p>
<p>app.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import React,&#123;useState,useCallback&#125; from &#x27;react&#x27;; ////導入</span><br><span class="line">import Button from &quot;./components/UI/Button/Button&quot;</span><br><span class="line">import DemoOutput from &#x27;./components/Demo/DemoOutput&#x27;;</span><br><span class="line">import &#x27;./App.css&#x27;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line"></span><br><span class="line">const[showParagraph,setShowParagraph]=useState(false)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">console.log(&quot;app Running!!&quot;)</span><br><span class="line"></span><br><span class="line">const toggleParagraphHandler = useCallback(()=&gt;&#123; </span><br><span class="line"></span><br><span class="line">/////第一個argument為這個function,第二個為一個[],類似useEffect,空的也是告訴react這個function基本上不會改變,設置了之後Button.js裡面的console.log也沒有執行了,因為我們使用了useCallback(),把本來會因為每次execute變為新的function的問題解決了  </span><br><span class="line"></span><br><span class="line">setShowParagraph(prevShowparagraph=&gt;!prevShowparagraph)</span><br><span class="line"></span><br><span class="line">&#125;,[])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Hi there!&lt;/h1&gt;</span><br><span class="line">      &lt;DemoOutput show=&#123;false&#125;/&gt;</span><br><span class="line">      &lt;Button onClick=&#123;toggleParagraphHandler&#125;&gt;Toggle Paragraph!!&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<h3 id="useCallback-and-its-Dependencies"><a href="#useCallback-and-its-Dependencies" class="headerlink" title="useCallback() and its Dependencies"></a>useCallback() and its Dependencies</h3><p>app.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React,&#123;useState,useCallback&#125; from &#x27;react&#x27;;</span><br><span class="line">import Button from &quot;./components/UI/Button/Button&quot;</span><br><span class="line">import DemoOutput from &#x27;./components/Demo/DemoOutput&#x27;;</span><br><span class="line">import &#x27;./App.css&#x27;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line"></span><br><span class="line">const[showParagraph,setShowParagraph]=useState(false)</span><br><span class="line">const[allowToggle,setAllowToggle]=useState(false)</span><br><span class="line"></span><br><span class="line">console.log(&quot;app Running!!&quot;)</span><br><span class="line"></span><br><span class="line">const toggleParagraphHandler = useCallback(()=&gt;&#123;   </span><br><span class="line"></span><br><span class="line">if(allowToggle)&#123;</span><br><span class="line">setShowParagraph(prevShowparagraph=&gt;!prevShowparagraph)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,[])</span><br><span class="line"></span><br><span class="line">const allowToggleHandler=()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">setAllowToggle(true)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Hi there!&lt;/h1&gt;</span><br><span class="line">      &lt;DemoOutput show=&#123;showParagraph&#125;/&gt;</span><br><span class="line">      &lt;Button onClick=&#123;allowToggleHandler&#125;&gt;Allow Toggling!!&lt;/Button&gt;</span><br><span class="line">      &lt;Button onClick=&#123;toggleParagraphHandler&#125;&gt;Toggle Paragraph!!&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<p>在這個狀態不會執行,Functions in JavaScript are closures,when a function is defined which happened when this function app runs in this function’s case (toggleParagraphHandler) ,when that function here is defined,<strong>JavaScript basically locks in all the variables that we are using in there</strong>,all the variables that we are defined outside of the function that we are using, in this case,the <strong>allowToggle</strong>variable that is variable or constant coming from the app function and I using it inside of this function. Therefore,<strong>JavaScript close over that constant</strong> and <strong>basically store that constant for that function definition</strong>.That means the next time this function(toggleParagraphHandler) here is executed,this stored variable will be used,and with that the value of that variable at the point of the time,it was stored.<br>This generally is perfect,because this allow us to use variables from outside of the function,in the function,and call the function at any of time we want,which is exactly what we want for a function that we bind to a button.</p>
<p>The problem with that,and with useCallback however is that with useCallback we are telling React to store that function,and exactly that function somewhere in memory.<br>Now,when the app function is re-evaluated and re-executed because the toggle state changed then React will not recreate this function because we are using useCallback where we told React that we do not recreate it under no circumstances,so therefore the allowToggle value that React stored for our function is still the old allowToggle value from the first time the app component was executed not the most recent one, because JavaScript, as I explained that stored allowToggle this constant when it created that function here. </p>
<h3 id="小總結"><a href="#小總結" class="headerlink" title="小總結"></a>小總結</h3><ol>
<li>React 會把所有更動的最後狀態(state)回報給ReactDOM進行render</li>
<li>component在執行的時候其實都是function,所以父層component執行,子層也會跟著執行,即便是同一個function,re-execute之後就算是新的function</li>
<li>useCallback()可以解決使用React.memo()時,因為傳遞資料的形式為reference value(array,object,function)所造成的component依然會re-execute的問題</li>
</ol>
<h3 id="A-Closer-Look-At-State-amp-Components"><a href="#A-Closer-Look-At-State-amp-Components" class="headerlink" title="A Closer Look At State &amp; Components"></a>A Closer Look At State &amp; Components</h3><p>React 在第一次執行的時候,就會把該componnet相關的state儲存起來並以新的function被呼叫,即便state的形式也是function,但是每次component因為state更新而re-execute的時候,useState並不會以新的function被呼叫,而是只是對state進行更新</p>
<h3 id="Understanding-State-Scheduling-amp-Batching"><a href="#Understanding-State-Scheduling-amp-Batching" class="headerlink" title="Understanding State Scheduling &amp; Batching"></a>Understanding State Scheduling &amp; Batching</h3><p>改變一個state根據另外一個state可以有兩種方式</p>
<ol>
<li>使用setShowParagraph(prevShowparagraph&#x3D;&gt;!prevShowparagraph) 這種格式</li>
<li>或是搭配使用useEffect</li>
<li>改變setState(新狀態)寫在一起,會被React打包在一起做為一個更新狀態</li>
</ol>
<h3 id="Optimizing-with-useMemo"><a href="#Optimizing-with-useMemo" class="headerlink" title="Optimizing with useMemo()"></a>Optimizing with useMemo()</h3><p>useMemo 可以用來儲存data</p>
<p>app.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import useMemo from &quot;react &quot; //導入</span><br><span class="line"></span><br><span class="line">const arrayData = useMemo(()=&gt;[5,3,1,10,9],[])</span><br><span class="line"></span><br><span class="line">&lt;DemoList items=&#123;arrayData&#125;&gt; ///這邊DemoList.js都設置了之後就可以確保不會一直re-execute</span><br></pre></td></tr></table></figure>

<p>DemoList.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import&#123;useMemo&#125; from &quot;React&quot; ///導入</span><br><span class="line"></span><br><span class="line">const&#123; items &#125;=props</span><br><span class="line"></span><br><span class="line">const sortList= useMemo(()=&gt;&#123; ///只設置這邊還是會變動,因為在上層的陣列資料每次re-execute都會被視為新的陣列</span><br><span class="line">items.sort((a,b)=&gt;return a-b</span><br><span class="line">)&#125;,[items]) </span><br><span class="line"></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://razieldu.github.io">Jeremy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://razieldu.github.io/2022/06/16/Udemy-React-TheCompleteGuide-ch12-A-Look-Behind-The-Scene-Of-React/">https://razieldu.github.io/2022/06/16/Udemy-React-TheCompleteGuide-ch12-A-Look-Behind-The-Scene-Of-React/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/06/18/Udemy-React-TheCompleteGuide-ch13-Class-Component/"><img class="prev-cover" src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Udemy-React-TheCompleteGuide ch13 Class Component</div></div></a></div><div class="next-post pull-right"><a href="/2022/06/13/Udemy-React-TheCompleteGuide-ch11-exercise/"><img class="next-cover" src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Udemy React TheCompleteGuide ch11 Exercise</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jeremy</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">74</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Razieldu"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#How-React-Really-works"><span class="toc-number">1.</span> <span class="toc-text">How React Really works</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Re-evaluating-Components-x3D-x3D-Re-render-the-DOM"><span class="toc-number">2.</span> <span class="toc-text">Re-evaluating Components !&#x3D;&#x3D; Re-render the DOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Component-Updates-in-Action"><span class="toc-number">3.</span> <span class="toc-text">Component Updates in Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-closer-look-at-child-component"><span class="toc-number">4.</span> <span class="toc-text">A closer look at child component</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preventing-Unnecessary-Re-Evaluations-with-React-memo"><span class="toc-number">5.</span> <span class="toc-text">Preventing Unnecessary Re-Evaluations with React.memo()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preventing-Function-Re-Creation-with-useCallback"><span class="toc-number">6.</span> <span class="toc-text">Preventing Function Re-Creation with useCallback()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useCallback-and-its-Dependencies"><span class="toc-number">7.</span> <span class="toc-text">useCallback() and its Dependencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%B8%BD%E7%B5%90"><span class="toc-number">8.</span> <span class="toc-text">小總結</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-Closer-Look-At-State-amp-Components"><span class="toc-number">9.</span> <span class="toc-text">A Closer Look At State &amp; Components</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Understanding-State-Scheduling-amp-Batching"><span class="toc-number">10.</span> <span class="toc-text">Understanding State Scheduling &amp; Batching</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Optimizing-with-useMemo"><span class="toc-number">11.</span> <span class="toc-text">Optimizing with useMemo()</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/08/05/Udemy-React-TheCompleteGuide-ch23-Next-JS/" title="Udemy-React-TheCompleteGuide ch23 Next JS  "><img src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Udemy-React-TheCompleteGuide ch23 Next JS  "/></a><div class="content"><a class="title" href="/2022/08/05/Udemy-React-TheCompleteGuide-ch23-Next-JS/" title="Udemy-React-TheCompleteGuide ch23 Next JS  ">Udemy-React-TheCompleteGuide ch23 Next JS  </a><time datetime="2022-08-05T08:51:55.000Z" title="Created 2022-08-05 16:51:55">2022-08-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/24/Redux-VS-Redux-ToolKit/" title="Redux VS Redux-ToolKit"><img src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redux VS Redux-ToolKit"/></a><div class="content"><a class="title" href="/2022/07/24/Redux-VS-Redux-ToolKit/" title="Redux VS Redux-ToolKit">Redux VS Redux-ToolKit</a><time datetime="2022-07-24T04:43:06.000Z" title="Created 2022-07-24 12:43:06">2022-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/15/Udemy-React-TheCompleteGuide-ch22-React-Authentication/" title="Udemy-React-TheCompleteGuide ch22 React Authenticaton  "><img src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Udemy-React-TheCompleteGuide ch22 React Authenticaton  "/></a><div class="content"><a class="title" href="/2022/07/15/Udemy-React-TheCompleteGuide-ch22-React-Authentication/" title="Udemy-React-TheCompleteGuide ch22 React Authenticaton  ">Udemy-React-TheCompleteGuide ch22 React Authenticaton  </a><time datetime="2022-07-15T07:47:55.000Z" title="Created 2022-07-15 15:47:55">2022-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/14/Udemy-React-TheCompleteGuide-ch21-React-Deploy/" title="Udemy-React-TheCompleteGuide ch21 Deploy React App with Firebase  "><img src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Udemy-React-TheCompleteGuide ch21 Deploy React App with Firebase  "/></a><div class="content"><a class="title" href="/2022/07/14/Udemy-React-TheCompleteGuide-ch21-React-Deploy/" title="Udemy-React-TheCompleteGuide ch21 Deploy React App with Firebase  ">Udemy-React-TheCompleteGuide ch21 Deploy React App with Firebase  </a><time datetime="2022-07-14T05:39:55.000Z" title="Created 2022-07-14 13:39:55">2022-07-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/06/Udemy-React-TheCompleteGuide-ch20-React-Router/" title="Udemy-React-TheCompleteGuide ch20 Muti Page SPA with React Router "><img src="https://github.com/Razieldu/BLOG-IMG/raw/main/%E9%83%A8%E8%90%BD%E6%A0%BC%E5%9C%96%E7%89%87.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Udemy-React-TheCompleteGuide ch20 Muti Page SPA with React Router "/></a><div class="content"><a class="title" href="/2022/07/06/Udemy-React-TheCompleteGuide-ch20-React-Router/" title="Udemy-React-TheCompleteGuide ch20 Muti Page SPA with React Router ">Udemy-React-TheCompleteGuide ch20 Muti Page SPA with React Router </a><time datetime="2022-07-06T11:28:55.000Z" title="Created 2022-07-06 19:28:55">2022-07-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Jeremy</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>